<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="main.css" />
    <title>Streamly Music Player</title>
  </head>
  <body>
    <div class="main">
      <div class="left">
        <div class="content-1">
          <div class="box-1">
            <div>
              <img
                style="fill: aliceblue"
                class="logo"
                src="/svg/logo.svg"
                alt="logo"
                srcset=""
              />
            </div>
            <div class="name">STREAMLY</div>
          </div>
          <div class="box-2">
            <div class="cont-1" onclick="showHome()">
              <img src="/svg/home.svg" alt="" />
              <li class="navigation">Home</li>
            </div>

            <div class="cont-1">
              <img src="/svg/ss.svg" alt="" />
              <li class="navigation">Search</li>
            </div>
            <div class="cont-1">
              <svg
                class="maker"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.03954 7.77203C3.57986 8.32856 2.35002 8.60682 2.05742 9.54773C1.76482 10.4886 2.60325 11.4691 4.2801 13.4299L4.71392 13.9372C5.19043 14.4944 5.42868 14.773 5.53586 15.1177C5.64305 15.4624 5.60703 15.8341 5.53498 16.5776L5.4694 17.2544C5.21588 19.8706 5.08912 21.1787 5.85515 21.7602C6.62118 22.3417 7.77268 21.8115 10.0757 20.7512L10.6715 20.4768C11.3259 20.1755 11.6531 20.0248 12 20.0248C12.3469 20.0248 12.6741 20.1755 13.3285 20.4768L13.9243 20.7512C16.2273 21.8115 17.3788 22.3417 18.1449 21.7602C18.9109 21.1787 18.7841 19.8706 18.5306 17.2544M19.7199 13.4299C21.3968 11.4691 22.2352 10.4886 21.9426 9.54773C21.65 8.60682 20.4201 8.32856 17.9605 7.77203L17.3241 7.62805C16.6251 7.4699 16.2757 7.39083 15.9951 7.17781C15.7144 6.96479 15.5345 6.64193 15.1745 5.99623L14.8468 5.40837C13.5802 3.13612 12.9469 2 12 2C11.0531 2 10.4198 3.13613 9.15316 5.40838"
                  stroke="#FFFFFF"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
              <li class="navigation">Artist</li>
            </div>
            <div class="cont-1" onclick="showFavorites()">
              <svg
                width="30px"
                height="30px"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M11.993 5.09691C11.0387 4.25883 9.78328 3.75 8.40796 3.75C5.42122 3.75 3 6.1497 3 9.10988C3 10.473 3.50639 11.7242 4.35199 12.67L12 20.25L19.4216 12.8944L19.641 12.6631C20.4866 11.7172 21 10.473 21 9.10988C21 6.1497 18.5788 3.75 15.592 3.75C14.2167 3.75 12.9613 4.25883 12.007 5.09692L12 5.08998L11.993 5.09691ZM12 7.09938L12.0549 7.14755L12.9079 6.30208L12.9968 6.22399C13.6868 5.61806 14.5932 5.25 15.592 5.25C17.763 5.25 19.5 6.99073 19.5 9.10988C19.5 10.0813 19.1385 10.9674 18.5363 11.6481L18.3492 11.8453L12 18.1381L5.44274 11.6391C4.85393 10.9658 4.5 10.0809 4.5 9.10988C4.5 6.99073 6.23699 5.25 8.40796 5.25C9.40675 5.25 10.3132 5.61806 11.0032 6.22398L11.0921 6.30203L11.9452 7.14752L12 7.09938Z"
                  fill="#ffffff"
                />
              </svg>
              <li class="navigation">Favorites</li>
            </div>
          </div>
        </div>
        <div class="content-2">
          <!-- fetch-mucic-form-playlist -->
          <div class="musiclist"></div>
        </div>
      </div>

      <div class="mid">
        <div class="nav"></div>
        <h3 id="main-heading">Trending Playlist</h3>

        <!-- //card/ -->
        <div class="cont-card">
          <!-- //playlist cards form json -->
        </div>
      </div>

      <div class="right"></div>
      <div class="playbar">
        <div class="section-1">
          <!-- current song details -->
          <div class="current-song-info">
            <div class="song-cover">
              <img id="current-cover" src="" alt="Song Cover" style="width: 50px; height: 50px; border-radius: 5px; display: none;">
            </div>
            <div class="song-details">
              <div id="current-title" style="color: white; font-size: 14px; font-weight: bold;"></div>
              <div id="current-artist" style="color: #ccc; font-size: 12px;"></div>
            </div>
          </div>
        </div>
        
        <div class="section-2">
          <div class="controller">
            <div class="controller-1">
              <img
                class="prevbtn"
                src="/svg/previous-svgrepo-com.svg"
                alt=""
                width="40"
                height="40"
                style="filter: brightness(0) invert(1); cursor: pointer"
              />
              <img
                class="play123"
                src="/svg/play.svg"
                alt=""
                width="40"
                height="40"
                style="filter: brightness(0) invert(1); cursor: pointer"
              />
              <img
                class="nextbtn"
                src="/svg/next-svgrepo-com.svg"
                alt=""
                width="40"
                height="40"
                style="filter: brightness(0) invert(1); cursor: pointer"
              />
            </div>

            <!-- ðŸ•’ Current Time Display Section -->
            <div class="controller-2">
              <div class="time-display" style="color: white; font-size: 14px; display: flex; align-items: center; gap: 10px;">
                <span class="current-time">0:00</span>
                <span style="color: #ccc;">/</span>
                <span class="duration">0:00</span>
              </div>
            </div>
          </div>
          
          <!-- seekbar with time labels -->
          <div class="musicbar">
            <div class="time-container" style="display: flex; align-items: center; gap: 10px; width: 100%;">
              <span class="current-time-small" style="color: #ccc; font-size: 12px; min-width: 35px;">0:00</span>
              <div class="line" style="flex: 1; position: relative;">
                <div class="dot"></div>
              </div>
              <span class="duration-small" style="color: #ccc; font-size: 12px; min-width: 35px;">0:00</span>
            </div>
          </div>
        </div>

        <!-- <div class="section-3" style="color: white;">volume controls</div> -->
      </div>
    </div>

    <script>
      let countplaylist; // number of playlists
      let songdata;

      let currentPlaylist = 0; // ðŸ”‘ keep track of which playlist is open
      let song = [];
      let currentidx = null;
      let currentView = 'home'; // Track current view: 'home' or 'favorites'
      let favorites = []; // Array to store favorite songs

      // Show home view
      function showHome() {
        currentView = 'home';
        displayplaylist();
        document.getElementById('main-heading').textContent = 'Trending Playlist';
        
        // Clear sidebar when going back to home
        document.querySelector(".musiclist").innerHTML = "";
        song = [];
        currentidx = null;
      }

      // ðŸ’– Favorites Management Functions
      function addToFavorites(playlistIndex, songIndex) {
        const songId = `${playlistIndex}-${songIndex}`;
        const songItem = songdata.playlists[playlistIndex].songs[songIndex];
        const playlist = songdata.playlists[playlistIndex];
        
        const favoriteItem = {
          id: songId,
          playlistIndex: playlistIndex,
          songIndex: songIndex,
          title: songItem.title,
          cover: songItem.cover,
          file: songItem.file,
          artistName: playlist.name
        };
        
        // Check if already in favorites
        const existingIndex = favorites.findIndex(fav => fav.id === songId);
        if (existingIndex === -1) {
          favorites.push(favoriteItem);
          console.log('Added to favorites:', favoriteItem.title);
        } else {
          favorites.splice(existingIndex, 1);
          console.log('Removed from favorites:', favoriteItem.title);
        }
        
        // Update the heart icon
        updateHeartIcon(songId);
        
        // If currently viewing favorites, refresh the view
        if (currentView === 'favorites') {
          showFavorites();
        }
      }
      
      function updateHeartIcon(songId) {
        const heartIcon = document.querySelector(`[data-song-id="${songId}"]`);
        if (heartIcon) {
          const isFavorite = favorites.some(fav => fav.id === songId);
          heartIcon.style.fill = isFavorite ? '#ff6b6b' : 'none';
          heartIcon.style.stroke = isFavorite ? '#ff6b6b' : '#ffffff';
        }
      }
      
      function showFavorites() {
        currentView = 'favorites';
        document.getElementById('main-heading').textContent = 'My Favorites';
        
        // Clear main content area
        const container = document.querySelector(".cont-card");
        container.innerHTML = "";
        
        if (favorites.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; color: #ccc; padding: 50px;">
              <h3>No favorites yet!</h3>
              <p>Add some songs to your favorites to see them here.</p>
            </div>`;
          
          // Clear sidebar too
          document.querySelector(".musiclist").innerHTML = "";
          return;
        }
        
        // Display favorite songs as cards
        favorites.forEach((favorite, index) => {
          const cardHTML = `
            <div class="cards favorite-card" onclick="playFavoriteSong(${index})">
              <div class="cover">
                <img class="artist-src" src="${favorite.cover}" alt="cover image">
              </div>
              <div class="song-info">
                <div class="artist" style="font-size: 14px;">${favorite.title}</div>
                <div style="font-size: 12px; color: #ccc;">${favorite.artistName}</div>
              </div>
            </div>`;
          container.innerHTML += cardHTML;
        });
        
        // Show favorites in sidebar too
        renderFavoritesSidebar();
      }
      
      function renderFavoritesSidebar() {
        song = []; // Reset current song array
        const sidesongs = document.querySelector(".musiclist");
        sidesongs.innerHTML = "";
        
        favorites.forEach((favorite, index) => {
          song.push(favorite.file); // Add to playable songs array
          
          const wrapper = `<div class="m1">
            <div class="cont-m1">
              <img src="${favorite.cover}" alt="songcover">
            </div>
            <div class="cont-m2">${favorite.title}</div>
            <div class="cont-m3">
              <img class="playbtn" data-no="${index}" src="/svg/play.svg" alt="" width="30" height="30" style="filter: brightness(0) invert(1);">
              <svg class="favbtn" data-song-id="${favorite.id}" onclick="removeFromFavorites('${favorite.id}')" width="20" height="20" viewBox="0 0 24 24" fill="#ff6b6b" stroke="#ff6b6b" style="cursor: pointer; margin-left: 10px;">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.993 5.09691C11.0387 4.25883 9.78328 3.75 8.40796 3.75C5.42122 3.75 3 6.1497 3 9.10988C3 10.473 3.50639 11.7242 4.35199 12.67L12 20.25L19.4216 12.8944L19.641 12.6631C20.4866 11.7172 21 10.473 21 9.10988C21 6.1497 18.5788 3.75 15.592 3.75C14.2167 3.75 12.9613 4.25883 12.007 5.09692L12 5.08998L11.993 5.09691ZM12 7.09938L12.0549 7.14755L12.9079 6.30208L12.9968 6.22399C13.6868 5.61806 14.5932 5.25 15.592 5.25C17.763 5.25 19.5 6.99073 19.5 9.10988C19.5 10.0813 19.1385 10.9674 18.5363 11.6481L18.3492 11.8453L12 18.1381L5.44274 11.6391C4.85393 10.9658 4.5 10.0809 4.5 9.10988C4.5 6.99073 6.23699 5.25 8.40796 5.25C9.40675 5.25 10.3132 5.61806 11.0032 6.22398L11.0921 6.30203L11.9452 7.14752L12 7.09938Z"/>
              </svg>
            </div>
          </div>`;
          
          sidesongs.innerHTML += wrapper;
        });
      }
      
      function playFavoriteSong(favoriteIndex) {
        renderFavoritesSidebar(); // Ensure sidebar is set up
        currentidx = favoriteIndex;
        
        if (favorites[favoriteIndex]) {
          audio.src = favorites[favoriteIndex].file;
          audio.play();
          
          // Update UI
          document.querySelectorAll(".playbtn").forEach((btn) => {
            btn.src = "/svg/play.svg";
          });
          
          const btn = document.querySelector(`.playbtn[data-no="${favoriteIndex}"]`);
          if (btn) btn.src = "/svg/pause.svg";
          
          document.querySelector(".play123").src = "/svg/pause.svg";
          
          // Update current song info
          updateFavoriteSongInfo(favoriteIndex);
        }
      }
      
      function updateFavoriteSongInfo(favoriteIndex) {
        if (favorites[favoriteIndex]) {
          const favorite = favorites[favoriteIndex];
          const currentTitle = document.getElementById("current-title");
          const currentArtist = document.getElementById("current-artist");
          const currentCover = document.getElementById("current-cover");
          
          if (currentTitle) currentTitle.textContent = favorite.title;
          if (currentArtist) currentArtist.textContent = favorite.artistName;
          if (currentCover) {
            currentCover.src = favorite.cover;
            currentCover.style.display = "block";
          }
        }
      }
      
      function removeFromFavorites(songId) {
        const index = favorites.findIndex(fav => fav.id === songId);
        if (index !== -1) {
          favorites.splice(index, 1);
          showFavorites(); // Refresh the favorites view
        }
      }

      async function displayplaylist() {
        await fetch("songs.json")
          .then((Response) => Response.json())
          .then((data) => {
            countplaylist = data.playlists.length;
            songdata = data;
          });

        // add playlist cards
        let container = document.querySelector(".cont-card");
        container.innerHTML = "";
        for (let i = 0; i < countplaylist; i++) {
          let artistname = songdata.playlists[i].name;
          let artistcover = songdata.playlists[i].artistcover;
          let artistindex = songdata.playlists[i].index;

          let cardsHTML = `<div class="cards" data-index="${artistindex}" onclick="rendersongs(${artistindex})">
            <div class="cover">
              <img class="artist-src" src="${artistcover}" alt="cover image">
            </div>
            <div class="song-info">
              <div class="artist">${artistname}</div>
            </div>
          </div>`;

          container.innerHTML += cardsHTML;
        }
      }

      // render songs of one playlist
      function rendersongs(value) {
        currentView = 'playlist';
        currentPlaylist = value; // ðŸ”‘ update current playlist
        song = []; // reset to only that playlist's songs

        let sidesongs = document.querySelector(".musiclist");
        sidesongs.innerHTML = "";

        let songslength = songdata.playlists[value].songs.length;

        for (let i = 0; i < songslength; i++) {
          let songurl = songdata.playlists[value].songs[i].file;
          let songtitle = songdata.playlists[value].songs[i].title;
          let cover = songdata.playlists[value].songs[i].cover;

          song.push(songurl); // only push songs of current playlist

          // Create unique song ID for favorites
          const songId = `${value}-${i}`;
          const isFavorite = favorites.some(fav => fav.id === songId);

          let wrapper = `<div class="m1">
            <div class="cont-m1">
              <img src="${cover}" alt="songcover">
            </div>
            <div class="cont-m2">${songtitle}</div>
            <div class="cont-m3">
              <img class="playbtn" data-no="${i}" src="/svg/play.svg" alt="" width="30" height="30" style="filter: brightness(0) invert(1);">
              <svg class="favbtn" data-song-id="${songId}" onclick="addToFavorites(${value}, ${i})" width="20" height="20" viewBox="0 0 24 24" fill="${isFavorite ? '#ff6b6b' : 'none'}" stroke="${isFavorite ? '#ff6b6b' : '#ffffff'}" style="cursor: pointer; margin-left: 10px;">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.993 5.09691C11.0387 4.25883 9.78328 3.75 8.40796 3.75C5.42122 3.75 3 6.1497 3 9.10988C3 10.473 3.50639 11.7242 4.35199 12.67L12 20.25L19.4216 12.8944L19.641 12.6631C20.4866 11.7172 21 10.473 21 9.10988C21 6.1497 18.5788 3.75 15.592 3.75C14.2167 3.75 12.9613 4.25883 12.007 5.09692L12 5.08998L11.993 5.09691ZM12 7.09938L12.0549 7.14755L12.9079 6.30208L12.9968 6.22399C13.6868 5.61806 14.5932 5.25 15.592 5.25C17.763 5.25 19.5 6.99073 19.5 9.10988C19.5 10.0813 19.1385 10.9674 18.5363 11.6481L18.3492 11.8453L12 18.1381L5.44274 11.6391C4.85393 10.9658 4.5 10.0809 4.5 9.10988C4.5 6.99073 6.23699 5.25 8.40796 5.25C9.40675 5.25 10.3132 5.61806 11.0032 6.22398L11.0921 6.30203L11.9452 7.14752L12 7.09938Z"/>
              </svg>
            </div>
          </div>`;

          sidesongs.innerHTML = sidesongs.innerHTML + wrapper;
        }
      }

      // one global audio element stores current playing song
      let audio = new Audio();

      // ðŸ•’ Format time helper function
      function formatTime(seconds) {
        if (isNaN(seconds)) return "0:00";
        
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      // ðŸ•’ Update current time display
      function updateCurrentTime() {
        const currentTimeElement = document.querySelector(".current-time");
        const durationElement = document.querySelector(".duration");
        
        if (currentTimeElement) {
          currentTimeElement.textContent = formatTime(audio.currentTime);
        }
        
        if (durationElement && audio.duration) {
          durationElement.textContent = formatTime(audio.duration);
        }
        
        // Update progress bar dot position
        if (audio.duration) {
          const progressPercentage = (audio.currentTime / audio.duration) * 100;
          const line = document.querySelector(".line");
          const dot = document.querySelector(".dot");
          
          if (line && dot) {
            const lineWidth = line.offsetWidth;
            const newPosition = (progressPercentage / 100) * lineWidth - (dot.offsetWidth / 2);
            dot.style.left = Math.max(0, Math.min(newPosition, lineWidth - dot.offsetWidth)) + "px";
          }
        }
      }

      // ðŸ•’ Update current song info display
      function updateCurrentSongInfo() {
        if (currentView === 'favorites') {
          updateFavoriteSongInfo(currentidx);
        } else if (currentidx !== null && songdata && songdata.playlists[currentPlaylist]) {
          const currentSong = songdata.playlists[currentPlaylist].songs[currentidx];
          const currentTitle = document.getElementById("current-title");
          const currentArtist = document.getElementById("current-artist");
          const currentCover = document.getElementById("current-cover");
          
          if (currentTitle) currentTitle.textContent = currentSong.title;
          if (currentArtist) currentArtist.textContent = songdata.playlists[currentPlaylist].name;
          if (currentCover) {
            currentCover.src = currentSong.cover;
            currentCover.style.display = "block";
          }
        }
      }

      // ðŸ•’ Audio event listeners for time updates
      audio.addEventListener("timeupdate", updateCurrentTime);
      audio.addEventListener("loadedmetadata", updateCurrentTime);

      // listen for clicks on play buttons
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("playbtn")) {
          let index = parseInt(e.target.dataset.no, 10);

          // ðŸŽµ If same song clicked
          if (currentidx === index) {
            if (audio.paused) {
              audio.play(); //  resume from paused position
              e.target.src = "/svg/pause.svg";
              document.querySelector(".play123").src = "/svg/pause.svg";
            } else {
              audio.pause(); //  pause but keep currentTime
              e.target.src = "/svg/play.svg";
              document.querySelector(".play123").src = "/svg/play.svg";
            }
            return; // ðŸ”‘ stop here so it won't reset src
          }

          // ðŸŽµ Different song â†’ load from start
          currentidx = index;
          audio.src = song[index];
          audio.play();

          // Update current song info
          updateCurrentSongInfo();

          // Reset all playlist buttons
          document.querySelectorAll(".playbtn").forEach((btn) => {
            btn.src = "/svg/play.svg";
          });

          // Set clicked button + playbar to pause icon
          e.target.src = "/svg/pause.svg";
          document.querySelector(".play123").src = "/svg/pause.svg";
        }
      });

      // playbar button
      let playbarBtn = document.querySelector(".play123");
      playbarBtn.addEventListener("click", () => {
        if (!currentidx && currentidx !== 0) return; // no song chosen yet

        if (audio.paused) {
          audio.play();
          playbarBtn.src = "/svg/pause.svg";

          // also update the playlist button for current song
          let btn = document.querySelector(`.playbtn[data-no="${currentidx}"]`);
          if (btn) btn.src = "/svg/pause.svg";
        } else {
          audio.pause();
          playbarBtn.src = "/svg/play.svg";

          // also update the playlist button for current song
          let btn = document.querySelector(`.playbtn[data-no="${currentidx}"]`);
          if (btn) btn.src = "/svg/play.svg";
        }
      });

      // previous button
      let prevbtn = document.querySelector(".prevbtn");
      prevbtn.addEventListener("click", () => {
        if (currentidx == null) return; // no song selected yet

        // go to previous index (loop if needed)
        let previdx = (currentidx - 1 + song.length) % song.length;
        currentidx = previdx;

        // change source and play
        audio.src = song[previdx];
        audio.play();

        // Update current song info
        updateCurrentSongInfo();

        // reset all playlist buttons to play
        document.querySelectorAll(".playbtn").forEach((btn) => {
          btn.src = "/svg/play.svg";
        });

        // update the new active playlist button
        let btn = document.querySelector(`.playbtn[data-no="${previdx}"]`);
        if (btn) btn.src = "/svg/pause.svg";

        // update playbar
        document.querySelector(".play123").src = "/svg/pause.svg";
      });

      // next button
      let nextbtn = document.querySelector(".nextbtn");
      nextbtn.addEventListener("click", () => {
        if (currentidx == null) return; // no song selected yet

        // go to next index (loop if needed)
        let nextidx = (currentidx + 1) % song.length;
        currentidx = nextidx;

        // change source and play
        audio.src = song[nextidx];
        audio.play();

        // Update current song info
        updateCurrentSongInfo();

        // reset all playlist buttons to play
        document.querySelectorAll(".playbtn").forEach((btn) => {
          btn.src = "/svg/play.svg";
        });

        // update the new active playlist button
        let btn = document.querySelector(`.playbtn[data-no="${nextidx}"]`);
        if (btn) btn.src = "/svg/pause.svg";

        // update playbar
        document.querySelector(".play123").src = "/svg/pause.svg";
      });

      // ðŸ•’ Enhanced dot movement with seek functionality
      let line = document.querySelector(".line");
      line.addEventListener("click", (e) => {
        if (!audio.duration) return; // no song loaded
        
        let dot = document.querySelector(".dot");
        let point = e.offsetX;
        let lineWidth = line.offsetWidth;
        
        // Calculate seek position as percentage
        let seekPercentage = point / lineWidth;
        let seekTime = seekPercentage * audio.duration;
        
        // Update audio current time
        audio.currentTime = seekTime;
        
        // Update dot position
        let actualpoint = point - dot.offsetWidth / 2;
        actualpoint = Math.max(0, Math.min(actualpoint, lineWidth - dot.offsetWidth));
        dot.style.left = actualpoint + "px";
      });

      // ðŸ•’ Auto-advance to next song when current song ends
     // ðŸ•’ Auto-advance to next song when current song ends
      audio.addEventListener("ended", () => {
        if (currentidx !== null && song.length > 0) {
          let nextidx = (currentidx + 1) % song.length;
          currentidx = nextidx;

          // change source and play
          audio.src = song[nextidx];
          audio.play();

          // Update current song info
          updateCurrentSongInfo();

          // reset all playlist buttons to play
          document.querySelectorAll(".playbtn").forEach((btn) => {
            btn.src = "/svg/play.svg";
          });

          // update the new active playlist button
          let btn = document.querySelector(`.playbtn[data-no="${nextidx}"]`);
          if (btn) btn.src = "/svg/pause.svg";

          // update playbar
          document.querySelector(".play123").src = "/svg/pause.svg";
        }
      });

      // Initialize the app
      displayplaylist();
    </script>
  </body>
</html>